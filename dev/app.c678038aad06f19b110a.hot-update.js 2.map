{"version":3,"file":"app.c678038aad06f19b110a.hot-update.js","sources":["/Users/geekyants/Desktop/Hackathon-21/crypto-base/src/store/actions/actionProfile.ts"],"sourcesContent":["import { Dispatch } from 'redux';\n\nimport * as types from './actionTypes';\nimport { normalizeError } from '../../services/helpers';\nimport { apiEndPoints, authApi } from '../../services/api';\n\nconst authSuccess = (userId: string, idToken: string, email: string) => {\n  return {\n    type: types.AUTH_SUCCESS,\n    userId,\n    idToken,\n    email,\n  };\n};\n\nconst authFailed = (error: string) => {\n  return {\n    type: types.AUTH_FAILED,\n    error,\n  };\n};\n\nexport const auth = (email: string, password: string, isSignUp: boolean) => {\n  const info = {\n    email: email,\n    password: password,\n    returnSecureToken: true,\n  };\n\n  let authURL = apiEndPoints.signUp;\n\n  if (!isSignUp) {\n    authURL = apiEndPoints.signIn;\n  }\n\n  return async (dispatch: Dispatch<any>) => {\n    try {\n      const response = await authApi(authURL, 'post', info);\n      const json = await response.json();\n      if (response.ok) {\n        const { localId, idToken, email, expiresIn } = json;\n        dispatch(authSuccess(localId, idToken, email));\n        localStorage.setItem('idToken', idToken);\n        localStorage.setItem('userId', localId);\n        localStorage.setItem('userEmail', email);\n        const expirationDate = new Date(\n          new Date().getTime() + expiresIn * 10000 * 24,\n        );\n        localStorage.setItem('expirationDate', String(expirationDate));\n        dispatch(authAutoLogout(json.expiresIn));\n      } else {\n        const { message } = json.error;\n        dispatch(authFailed(normalizeError(message)));\n      }\n    } catch (error: any) {\n      dispatch(authFailed(normalizeError(error.message)));\n    }\n  };\n};\n\nexport const authLogout = () => {\n  localStorage.removeItem('idToken');\n  localStorage.removeItem('userId');\n  localStorage.removeItem('expirationDate');\n  localStorage.removeItem('userEmail');\n  return {\n    type: types.AUTH_LOGOUT,\n  };\n};\n\nconst authAutoLogout = (time: number) => {\n  return (dispatch: Dispatch<any>) => {\n    setTimeout(() => {\n      dispatch(authLogout());\n    }, time * 1000);\n  };\n};\n\nexport const checkAuthState = () => {\n  return (dispatch: Dispatch<any>) => {\n    let tokenId = localStorage.getItem('idToken');\n    if (!tokenId) {\n      dispatch(authLogout());\n    } else {\n      const currentExpirationDate = localStorage.getItem('expirationDate');\n      if (\n        currentExpirationDate &&\n        new Date(currentExpirationDate) > new Date()\n      ) {\n        const userId = localStorage.getItem('userId');\n        const idToken = localStorage.getItem('idToken');\n        const userEmail = localStorage.getItem('userEmail');\n        if (userId && idToken && userEmail) {\n          dispatch(authSuccess(userId, idToken, userEmail));\n        }\n      } else {\n        authLogout();\n      }\n    }\n  };\n};\n\nexport const clearAuthError = () => {\n  return {\n    type: types.AUTH_ERROR_CLEAR,\n  };\n};\n"],"mappings":";;;;;;;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAIA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AADA;AAGA;;;;A","sourceRoot":""}